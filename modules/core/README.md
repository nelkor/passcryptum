# Passcryptum core

Данный пакет содержит всю криптографическую функциональность Passcryptum. Его
создание мотивировано желанием отделить эту логику от логики интерфейса приложения.
Будучи отделённой, эта функциональность не зависит от фреймворка интерфейса и не
спутывается со сторонними зонами ответственности.

## Вход/выход

Вся функциональность ядра Passcryptum строится на криптографических данных,
полученных из исходного пароля. Под "входом в систему" подразумевается получение
ядром Passcryptum этих данных (начало активной сессии). Соответственно, под
"выходом из системы" — удаление этих данных из оперативной памяти
(окончание активной сессии).

Начиная сессию, клиент ядра Passcryptum получает идентификатор сессии
(строка, четыре латинские буквы), а также сохранённые для этой сессии данные
(произвольная строка, например, JSON).

### Вход при помощи исходного пароля

```typescript
declare const enterWithOriginPassword: (
  password: string
) => Promise<{ id: string; data: string | null }>
```

Принимает строку (исходный пароль), запускает сессию.
Асинхронно возвращает объект с идентификатором и данными.
Используется медленная криптография, вычисление может занять время.

### Вход при помощи ПИН-кода

```typescript
declare const enterWithPin: (
  pin: string
) => Promise<{ id: string; data: string | null }>
```

Принимает строку (ПИН-код). Ищет в локальном хранилище зашифрованный хеш
исходного пароля и пробует его расшифровать. Используется медленная криптография,
вычисление может занять время. Если не получается — выбрасывает исключение.
Запускает сессию. Асинхронно возвращает объект с идентификатором и данными.

### Выход

```typescript
declare const exit: () => void
```

Завершает сессию. Все функции, зависящие от данных сессии,
перестают работать (начинают выбрасывать исключение).

## Хранение данных

### Сохранение данных

```typescript
declare const saveData: (data: string) => Promise<void>
```

Выбросит исключение, если сессия не активна.

Принимает строку (например, JSON). Строка зашифровывается данными
активной сессии и сохраняется в локальное хранилище.

### Чтение зашифрованных данных

```typescript
declare const readData: (data: string | ArrayBuffer) => Promise<string | null>
```

Выбросит исключение, если сессия не активна.

Принимает строку или буфер. Пробует расшифровать её данными активной сессии.
Если не получается — возвращает `null`.
Возвращает расшифрованные данные переданного аргумента в виде строки.

### Получение данных

```typescript
declare const getDataAsBuffer: () => Promise<ArrayBuffer | null>
declare const getDataAsString: () => Promise<string | null>
declare const getDataDecrypted: () => Promise<string | null>
```

Выбросит исключение, если сессия не активна.

Первые две функции возвращают зашифрованные данные, сохранённые в локальное
хранилище под ключом активной сессии. Отличается тип возвращаемых данных:

- `getDataAsBuffer` — бинарный вид;
- `getDataAsString` — hex-строка.

Последняя функция `getDataDecrypted` возвращает расшифрованную строку данных.

### Удаление данных

```typescript
declare const deleteData: () => void
```

Выбросит исключение, если сессия не активна.

Удаляет данные, сохранённые в локальное хранилище под ключом активной сессии.

## ПИН-код

### Проверка состояния ПИН-кода

```typescript
declare const isTherePin: () => boolean
```

Вернёт `true`, если PIN установлен и `false` в противном случае.

### Установка ПИН-кода

```typescript
declare const setPin: (pin: string) => Promise<void>
```

Выбросит исключение, если сессия не активна.

Устанавливает переданный PIN и записывает его в локальное хранилище.

### Удаление ПИН-кода

```typescript
declare const deletePin: () => void
```

Удаляет PIN.

## Генерация паролей

```typescript
declare const generatePassword: (
  serviceName: string,
  login: string,
  version: number,
  useSymbols: boolean,
  length: number
) => Promise<string>
```

Выбросит исключение, если сессия не активна.

Вычисляет пароль на основе текущей сессии и переданных параметров.
